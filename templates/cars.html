{% extends "base.html" %}
{% block content %}
<h1>–ö–∞—Ç–∞–ª–æ–≥ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</h1>
<div id="cars-list">
  {% for car in cars %}
  <div class="card">
    <h3>{{ car.brand }} {{ car.model }} ({{ car.year }})</h3>
    <p>üí∞ {{ car.price_per_day }} ‚ÇΩ/–¥–µ–Ω—å | ü™ë {{ car.seats }} –º–µ—Å—Ç | ‚öôÔ∏è {{ car.transmission }}</p>
    <form id="booking-{{ car.id }}" action="/create-checkout-session" method="POST">
      <input type="hidden" name="car_id" value="{{ car.id }}">
      <label>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞: <input type="date" name="start_date" required></label>
      <label>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è: <input type="date" name="end_date" required></label>
      <button type="submit" class="btn">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
    </form>
  </div>
  {% endfor %}
</div>

<script>
document.querySelectorAll('form').forEach(form => {
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const data = Object.fromEntries(formData);
    const res = await fetch('/create-checkout-session', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(data)
    });
    const result = await res.json();
    if (result.url) window.location = result.url;
  });
});
</script>
{% endblock %}
